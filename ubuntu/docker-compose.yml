# This Compose file defines two Ubuntu-based services sharing core configuration
# for user environments and network settings, using YAML anchors to enforce DRY.

version: '3.5'

# Shared settings for all Ubuntu services
x-ubuntu-base: &ubuntu-base
  image: ubuntu:local
  restart: no
  networks:
    lan_net: {}

x-vol-conda: &vol-conda conda_app:/opt/conda
x-vol-shared: &vol-shared user_shared:/home/shared

services:
  ubuntu-luist:
    <<: *ubuntu-base
    container_name: "ubuntu-luist"
    environment:
      USERNAME: "luist"
    volumes:
      - *vol-conda
      - *vol-shared
      - user_data_luist:/home/luist
    networks:
      lan_net:
        ipv4_address: 192.168.1.100

  ubuntu-carlj:
    <<: *ubuntu-base
    container_name: "ubuntu-carlj"
    environment:
      USERNAME: "carlj"
    volumes:
      - *vol-conda
      - *vol-shared
      - user_data_carlj:/home/carlj
    networks:
      lan_net:
        ipv4_address: 192.168.1.101

volumes:
  user_shared:
    external: true
  conda_app:
    external: true
  
  user_data_luist:
    external: false
  user_data_carlj:
    external: false

networks:
  lan_net:
    external: true